<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Walkthrough: M√©todos Criptogr√°ficos</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background-color: #0d1117;
        color: #c9d1d9;
        line-height: 1.6;
        margin: 0;
        padding: 20px;
      }
      .container {
        max-width: 900px;
        margin: 0 auto;
        background-color: #161b22;
        padding: 40px;
        border-radius: 6px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      }
      h1,
      h2,
      h3 {
        color: #ffffff;
        border-bottom: 1px solid #21262d;
        padding-bottom: 0.3em;
      }
      h1 {
        font-size: 2em;
      }
      h2 {
        font-size: 1.5em;
        margin-top: 1.5em;
      }
      h3 {
        font-size: 1.25em;
        margin-top: 1.2em;
        color: #58a6ff;
      }

      code {
        font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas,
          Liberation Mono, monospace;
        background-color: rgba(110, 118, 129, 0.4);
        padding: 0.2em 0.4em;
        border-radius: 6px;
        font-size: 85%;
      }

      pre {
        background-color: #161b22;
        padding: 16px;
        overflow: auto;
        border-radius: 6px;
      }

      .mermaid {
        background-color: #0d1117;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
        display: flex;
        justify-content: center;
      }

      table {
        border-collapse: collapse;
        width: 100%;
        margin: 20px 0;
      }

      th,
      td {
        border: 1px solid #30363d;
        padding: 6px 13px;
      }

      th {
        background-color: #161b22;
        font-weight: 600;
      }

      tr:nth-child(2n) {
        background-color: #0d1117;
      }

      blockquote {
        color: #8b949e;
        border-left: 0.25em solid #30363d;
        padding-left: 1em;
        margin-left: 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Walkthrough: M√©todos Criptogr√°ficos y Flujos de Datos</h1>

      <p>
        Este documento detalla los procesos internos de los diferentes m√©todos
        de cifrado utilizados en la aplicaci√≥n, ilustrados mediante diagramas de
        flujo interactivos.
      </p>

      <hr />

      <h2>1. Cifrado H√≠brido (Multi-Usuario)</h2>

      <p>
        Este es el m√©todo principal para compartir archivos de forma segura.
        Combina la eficiencia de <strong>AES</strong> para cifrar datos con la
        seguridad de <strong>RSA</strong> para intercambiar la clave.
      </p>

      <h3>üìù Proceso de Cifrado</h3>
      <p>El usuario "Alice" quiere enviar un archivo a "Bob" y "Charlie".</p>

      <div class="mermaid">
        flowchart TD Start([Inicio: Alice selecciona Archivo y Destinatarios])
        --> GenKey[Generar Clave Aleatoria AES-256] subgraph SImetrico [Cifrado
        de Datos] GenKey --> EncFile[Cifrar Archivo con Clave AES] EncFile -->
        FileData[Datos Cifrados] end subgraph Asimetrico [Cifrado de Clave]
        GenKey --> LoopDest{Para cada destinatario} LoopDest -->|Bob|
        PubBob[Obtener Public Key Bob] LoopDest -->|Charlie| PubCharlie[Obtener
        Public Key Charlie] PubBob --> EncKey1[Cifrar Clave AES con RSA Public]
        PubCharlie --> EncKey2[Cifrar Clave AES con RSA Public] end FileData -->
        Package[Empaquetar JSON] EncKey1 --> Package EncKey2 --> Package Package
        --> FinalFile([Archivo Final .hybenc]) style Start
        fill:#2d333b,stroke:#c9d1d9,color:#fff style FinalFile
        fill:#1f6feb,stroke:#c9d1d9,color:#fff style GenKey
        fill:#238636,stroke:#c9d1d9,color:#fff
      </div>

      <h3>üîì Proceso de Descifrado</h3>
      <p>"Bob" recibe el archivo cifrado y quiere leerlo.</p>

      <div class="mermaid">
        flowchart TD Start([Inicio: Bob abre archivo .hybenc]) -->
        ReadHeader[Leer Cabecera JSON] ReadHeader --> FindRec{¬øEst√° Bob en
        destinatarios?} FindRec -->|No| Error([Error: Acceso Denegado]) FindRec
        -->|Si| GetEncKey[Extraer Clave AES Cifrada para Bob] subgraph Auth
        [Autenticaci√≥n] GetEncKey --> AskPass[Solicitar Contrase√±a de Bob]
        AskPass --> ValPass{Validar Contrase√±a} ValPass -->|Invalida| Error end
        subgraph PrivateKey [Recuperaci√≥n Clave Privada] ValPass -->|Valida|
        LoadPrivEnc[Leer bob.key.enc] LoadPrivEnc --> DecPriv[Descifrar Clave
        Privada RSA usando Password] end subgraph Decrypt [Descifrado] DecPriv
        --> DecAESKey[Descifrar Clave AES de Sesi√≥n] DecAESKey -->
        DecFile[Descifrar Contenido del Archivo] end DecFile -->
        Success([Archivo Descifrado Exitosamente]) style Start
        fill:#2d333b,stroke:#c9d1d9,color:#fff style Error
        fill:#da3633,stroke:#c9d1d9,color:#fff style Success
        fill:#238636,stroke:#c9d1d9,color:#fff
      </div>

      <hr />

      <h2>2. Protecci√≥n de Claves (Almac√©n de Usuario)</h2>

      <p>
        Sistema dise√±ado para almacenar las claves AES generadas manualmente o
        autom√°ticamente, cifr√°ndolas de forma que solo el usuario propietario
        pueda acceder a ellas.
      </p>

      <h3>üîê Flujo de Seguridad: Cadena de Confianza</h3>

      <p>Este diagrama muestra c√≥mo se protegen las claves AES almacenadas.</p>

      <div class="mermaid">
        flowchart TD Pass([User Password]) -->|PBKDF2| KEK[Key Encryption Key]
        KEK -->|AES-256| RSAPriv[RSA Private Key] RSAPriv -->|SHA-256 Hash|
        AESKey[Storage AES Key] AESKey -->|AES-CBC| Database[("Base de Datos de
        Claves (.enc)")] subgraph Nivel1 [Nivel 1: Autenticaci√≥n] Pass KEK end
        subgraph Nivel2 [Nivel 2: Identidad] RSAPriv end subgraph Nivel3 [Nivel
        3: Almacenamiento] AESKey Database end style Pass
        fill:#2d333b,stroke:#c9d1d9,color:#fff style RSAPriv
        fill:#1f6feb,stroke:#c9d1d9,color:#fff style Database
        fill:#da3633,stroke:#c9d1d9,color:#fff
      </div>

      <ol>
        <li>
          <strong>Nivel 1:</strong> La contrase√±a del usuario desbloquea su
          <strong>Clave Privada RSA</strong>.
        </li>
        <li>
          <strong>Nivel 2:</strong> La Clave Privada RSA (que es √∫nica e
          intransferible) se usa para derivar matem√°ticamente una
          <strong>Clave de Almacenamiento</strong>.
        </li>
        <li>
          <strong>Nivel 3:</strong> Esa clave cifra el archivo JSON que contiene
          todas las claves AES guardadas.
        </li>
      </ol>

      <hr />

      <h2>3. Cifrado Sim√©trico Manual (AES Tradicional)</h2>

      <p>
        Cifrado directo de un archivo usando una clave proporcionada (o
        generada) manualmente.
      </p>

      <div class="mermaid">
        flowchart TD Start([Inicio: Usuario ingresa Datos]) --> Inputs[Archivo +
        Clave + Algoritmo] subgraph Prep [Preparaci√≥n] Inputs -->
        Norm[Normalizar Clave a Bytes] Norm --> GenIV[Generar IV Aleatorio] end
        subgraph Enc [Cifrado] GenIV --> DoEnc[AES Encrypt CBC/CFB/OFB] DoEnc
        --> OutFile([Archivo Cifrado .enc]) end subgraph Storage [Auto-Guardado]
        OutFile --> AskPass[Pedir Contrase√±a Usuario Activo] AskPass -->
        Val{¬øContrase√±a Correcta?} Val -->|No| Skip[No guardar clave] Val
        -->|Si| CalcKey[Derivar Storage Key de RSA Privada] CalcKey -->
        SaveKey[(Guardar en Almac√©n Seguro)] end Skip --> End([Fin]) SaveKey -->
        End style Start fill:#2d333b,stroke:#c9d1d9,color:#fff style OutFile
        fill:#238636,stroke:#c9d1d9,color:#fff style SaveKey
        fill:#1f6feb,stroke:#c9d1d9,color:#fff
      </div>

      <hr />

      <h2>Resumen de Archivos Generados</h2>

      <table>
        <thead>
          <tr>
            <th>Tipo de Cifrado</th>
            <th>Extensi√≥n</th>
            <th>Contenido</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>H√≠brido</strong></td>
            <td><code>.hybenc</code></td>
            <td>Metadatos JSON (Keys cifradas con RSA) + Binario AES</td>
          </tr>
          <tr>
            <td><strong>Sim√©trico</strong></td>
            <td><code>.enc</code> / <code>.aes</code></td>
            <td>Solo datos cifrados (IV suele ir prepend o separado)</td>
          </tr>
          <tr>
            <td><strong>Clave Privada</strong></td>
            <td><code>.key.enc</code></td>
            <td>Salt + IV + Clave Privada RSA (Cifrada con Password)</td>
          </tr>
          <tr>
            <td><strong>Almac√©n Claves</strong></td>
            <td><code>_keys.enc</code></td>
            <td>IV + Lista JSON de claves AES (Cifrada con RSA-derived key)</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Mermaid JS -->
    <script type="module">
      import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
      mermaid.initialize({
        startOnLoad: true,
        theme: "dark",
      });
    </script>
  </body>
</html>
